# 重要性采样   

## 1.重要性采样  

  一种用来估计复杂分布下期望值的方法，核心思想是用一个容易采样的分布来代替目标分布来采样，通过加权来修正这种代替带来的偏差  

## 2.步骤
（1）选一个容易采样的分布q(x)，叫提议分布  
（2）从q(x)里面采样很多样本  
（3）给每个样本加权，权重是p(x)/q(x)，其中p(x)是想要计算的目标分布  
## 3.公式
重要性采样的期望估计公式是：
![image](https://github.com/user-attachments/assets/c35797c7-8ce1-4f66-ad57-9425429aac65)
在这个公式中，我们想要计算复杂分布p(x)下f(x)的期望，如果p(x)如果比较复杂或者无法直接采样，那么就可以引入一个易于采样的q(x)，通过q(x)采样来估计  
<div align=center>
  <img src="https://github.com/user-attachments/assets/6d56741e-a9e7-4f21-a244-0773d34c61c3" width="500" />
</div>
其中xi~q(x)，即从简单分布采样得来，w(xi) = p(xi)/q(xi)被称为重要性权重，每个样本都会乘以一个重要性权重  

## 4.重要性采样的关键点  
要选取q(x)和p(x)相近的分布，如果两者相差太远会怎样：  
（1）权重波动很大（高方差）  
· 某些样本的权重p(x)/q(x)会非常大  
· 大多数样本的权重为0  
· 估计十分不稳定，容易被少数几个样本主导  
（2）某些重要区域被忽略  
如果q(x)在p(x)有质量的区域没有覆盖，即q(x)=0而p(x)>0，则这些区域将永远采不到，从而导致估计严重偏差  

  举例：  
  假设目标分布p(x)~N(0,1)，你想估计Ep[x^2]，如果从q(x)~N(10,1)采样，大部分样本都在x=10附近，而p(x=10)约等于0，这样的结果就是：绝大多数样本权重都接近0，偶尔有一个离x=0比较近的样本权重大到离谱，最终估计极其不稳定，相比之下，采取q(x)~N(0,1.5)，它与p(x)接近，更合理。  

    实际中，选择高斯分布、均匀分布、或通过经验分布/先验分布来近似p(x)
